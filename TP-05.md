
## **TP-05 : DÃ©veloppement d'une Application de Gestion d'Utilisateurs**

### **Objectifs**
1. DÃ©velopper une application Java suivant une architecture **MVC modulaire**.
2. Utiliser JDBC pour interagir avec une base de donnÃ©es MySQL.
3. ImplÃ©menter un systÃ¨me sÃ©curisÃ© de gestion des mots de passe avec **SHA-256**.
4. GÃ©rer les exceptions Ã  l'aide de classes personnalisÃ©es.
5. Ajouter des fonctionnalitÃ©s graphiques avec **Swing**.
6. Ajouter des champs utilisateur supplÃ©mentaires : mÃ©tier, adresse, date de naissance, lieu de naissance, salaire.
7. Fournir un **diagramme de classes UML** dÃ©crivant le systÃ¨me.

---

## **Ã‰tapes de RÃ©alisation**

### **1. Configuration de la Base de DonnÃ©es**
CrÃ©ez une base de donnÃ©es et la table `users` :

```sql
CREATE DATABASE user_management;

USE user_management;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    job VARCHAR(255),
    address VARCHAR(255),
    birth_date DATE,
    birth_place VARCHAR(255),
    salary DECIMAL(10, 2)
);
```

---

### **2. Structure du Projet**

Organisez votre projet comme suit :

```
src/
â”œâ”€â”€ app/                  // Point d'entrÃ©e principal
â”‚   â””â”€â”€ Main.java
â”œâ”€â”€ controllers/          // ContrÃ´leurs pour orchestrer l'application
â”‚   â””â”€â”€ UserController.java
â”œâ”€â”€ exceptions/           // Exceptions personnalisÃ©es
â”‚   â”œâ”€â”€ DatabaseException.java
â”‚   â”œâ”€â”€ UserNotFoundException.java
â”‚   â””â”€â”€ AuthenticationException.java
â”œâ”€â”€ interfaces/           // Interfaces pour l'abstraction
â”‚   â”œâ”€â”€ IUserRepository.java
â”‚   â””â”€â”€ IUserService.java
â”œâ”€â”€ models/               // Classes reprÃ©sentant les donnÃ©es
â”‚   â””â”€â”€ User.java
â”œâ”€â”€ repositories/         // AccÃ¨s aux donnÃ©es et interactions JDBC
â”‚   â””â”€â”€ UserRepository.java
â”œâ”€â”€ services/             // Logique mÃ©tier et transformations des donnÃ©es
â”‚   â””â”€â”€ UserService.java
â”œâ”€â”€ utils/                // Classes utilitaires pour les tÃ¢ches communes
â”‚   â”œâ”€â”€ DatabaseConnection.java
â”‚   â””â”€â”€ PasswordHasher.java
â””â”€â”€ views/                // Interfaces utilisateur
    â”œâ”€â”€ UserConsoleView.java
    â””â”€â”€ UserSwingView.java
```

---

### **3. Contenu des Fichiers**

#### **3.1. Point d'entrÃ©e principal : `Main.java`**
```java
package app;

import controllers.UserController;

public class Main {
    public static void main(String[] args) {
        UserController controller = new UserController();
        controller.run();
    }
}
```

---

#### **3.2. ModÃ¨le : `User.java`**
Ajoutez les champs supplÃ©mentaires.

```java
package models;

import java.util.Date;

public class User {
    private int id;
    private String username;
    private String password;
    private String job;
    private String address;
    private Date birthDate;
    private String birthPlace;
    private double salary;

    public User(int id, String username, String password, String job, String address, Date birthDate, String birthPlace, double salary) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.job = job;
        this.address = address;
        this.birthDate = birthDate;
        this.birthPlace = birthPlace;
        this.salary = salary;
    }

    // Getters and setters
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }
    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }
    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }
    public String getJob() { return job; }
    public void setJob(String job) { this.job = job; }
    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }
    public Date getBirthDate() { return birthDate; }
    public void setBirthDate(Date birthDate) { this.birthDate = birthDate; }
    public String getBirthPlace() { return birthPlace; }
    public void setBirthPlace(String birthPlace) { this.birthPlace = birthPlace; }
    public double getSalary() { return salary; }
    public void setSalary(double salary) { this.salary = salary; }
}
```

---

#### **3.3. Interfaces**
##### `IUserRepository.java`
```java
package interfaces;

import models.User;
import java.util.List;

public interface IUserRepository {
    List<User> getAllUsers();
    void addUser(User user);
    boolean authenticateUser(String username, String hashedPassword);
    void deleteUser(int userId);
}
```

##### `IUserService.java`
```java
package interfaces;

import models.User;
import java.util.List;

public interface IUserService {
    List<User> getAllUsers();
    void addUser(String username, String password, String job, String address, String birthDate, String birthPlace, double salary);
    boolean authenticateUser(String username, String password);
    void deleteUser(int userId);
}
```

---

#### **3.4. Repositories : `UserRepository.java`**
Mise Ã  jour pour inclure les champs supplÃ©mentaires.

```java
package repositories;

import exceptions.DatabaseException;
import interfaces.IUserRepository;
import models.User;
import utils.DatabaseConnection;

import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class UserRepository implements IUserRepository {
    @Override
    public List<User> getAllUsers() {
        String query = "SELECT * FROM users";
        List<User> users = new ArrayList<>();
        try (Connection connection = DatabaseConnection.getConnection();
             Statement statement = connection.createStatement();
             ResultSet resultSet = statement.executeQuery(query)) {
            while (resultSet.next()) {
                users.add(new User(
                    resultSet.getInt("id"),
                    resultSet.getString("username"),
                    null,
                    resultSet.getString("job"),
                    resultSet.getString("address"),
                    resultSet.getDate("birth_date"),
                    resultSet.getString("birth_place"),
                    resultSet.getDouble("salary")
                ));
            }
        } catch (SQLException e) {
            throw new DatabaseException("Error fetching users from the database.", e);
        }
        return users;
    }

    @Override
    public void addUser(User user) {
        String query = "INSERT INTO users (username, password, job, address, birth_date, birth_place, salary) VALUES (?, ?, ?, ?, ?, ?, ?)";
        try (Connection connection = DatabaseConnection.getConnection();
             PreparedStatement preparedStatement = connection.prepareStatement(query)) {
            preparedStatement.setString(1, user.getUsername());
            preparedStatement.setString(2, user.getPassword());
            preparedStatement.setString(3, user.getJob());
            preparedStatement.setString(4, user.getAddress());
            preparedStatement.setDate(5, new java.sql.Date(user.getBirthDate().getTime()));
            preparedStatement.setString(6, user.getBirthPlace());
            preparedStatement.setDouble(7, user.getSalary());
            preparedStatement.executeUpdate();
        } catch (SQLException e) {
            throw new DatabaseException("Error adding user to the database.", e);
        }
    }

    @Override
    public boolean authenticateUser(String username, String hashedPassword) {
        String query = "SELECT * FROM users WHERE username = ? AND password = ?";
        try (Connection connection = DatabaseConnection.getConnection();
             PreparedStatement preparedStatement = connection.prepareStatement(query)) {
            preparedStatement.setString(1, username);
            preparedStatement.setString(2, hashedPassword);
            try (ResultSet resultSet = preparedStatement.executeQuery()) {
                return resultSet.next();
            }
        } catch (SQLException e) {
            throw new DatabaseException("Error during user authentication.", e);
        }
    }

    @Override
    public void deleteUser(int userId) {
        String query = "DELETE FROM users WHERE id = ?";
        try (Connection connection = DatabaseConnection.getConnection();
             PreparedStatement preparedStatement = connection.prepareStatement(query)) {
            preparedStatement.setInt(1, userId);
            preparedStatement.executeUpdate();
        } catch (SQLException e) {
            throw new DatabaseException("Error deleting user from the database.", e);
        }
    }
}
```

---

### **5. Bonus**
1. **Interface graphique Swing :**
   ImplÃ©mentez une interface utilisateur avec des champs pour les nouvelles informations et des boutons pour effectuer les actions CRUD.
2. **Diagramme UML :**
   RÃ©alisez un **diagramme de classe UML** dÃ©crivant l'architecture complÃ¨te, incluant les relations entre les couches **MVC**, les interfaces, et les classes utilitaires.

Bonne chanceâ€¯! Un diagramme UML dÃ©taillÃ© et une interface graphique complÃ¨te augmenteront votre note finale. ðŸ˜Š
